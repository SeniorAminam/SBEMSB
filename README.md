<div align="center">

# ๐ขโก SBEMSB

**Smart Building Energy Management System โ Telegram Bot**

ุณุงูุงูู ูุฏุฑุช ููุดููุฏ ูุตุฑู ุงูุฑฺ ุณุงุฎุชูุงู ุจุง ุฑุจุงุช ุชูฺฏุฑุงู + ุดุจูโุณุงุฒ IoT + Digital Twin + ูพููโูุง ููุดโูุญูุฑ.

<a href="https://github.com/SeniorAminam/SBEMSB/actions/workflows/ci.yml">
  <img alt="CI" src="https://github.com/SeniorAminam/SBEMSB/actions/workflows/ci.yml/badge.svg" />
</a>
<img alt="PHP" src="https://img.shields.io/badge/PHP-8.1%2B-777BB4?logo=php&logoColor=white" />
<img alt="MySQL" src="https://img.shields.io/badge/MySQL-8%2B-4479A1?logo=mysql&logoColor=white" />
<img alt="License" src="https://img.shields.io/github/license/SeniorAminam/SBEMSB?color=2ea44f" />
<img alt="Telegram" src="https://img.shields.io/badge/Telegram-Bot-26A5E4?logo=telegram&logoColor=white" />
<img alt="Composer" src="https://img.shields.io/badge/Composer-Enabled-885630?logo=composer&logoColor=white" />

๐ Repo: https://github.com/SeniorAminam/SBEMSB

</div>

## ๐ ููุฑุณุช ูุทุงูุจ

- [โจ ุงูฺฉุงูุงุช](#-ุงูฺฉุงูุงุช-features)
- [๐งฐ ุชฺฉููููฺโูุง ู ุงุณุชฺฉ](#-ุชฺฉููููฺูุง-ู-ุงุณุชฺฉ)
- [๐งโ๐ป ุฏุฑุจุงุฑู ุณุงุฒูุฏู](#-ุฏุฑุจุงุฑู-ุณุงุฒูุฏู)
- [๐งฉ ุณุงุฎุชุงุฑ ูพุฑูฺู](#-ุณุงุฎุชุงุฑ-ูพุฑูฺู-project-structure)
- [โ๏ธ ูุนูุงุฑ ู ูฺฉุงูุฒู ฺฉุงุฑ ุฑุจุงุช](#๏ธ-ูุนูุงุฑ-ู-ูฺฉุงูุฒู-ฺฉุงุฑ-ุฑุจุงุช)
- [๐๏ธ ุฏุชุงุจุณ](#๏ธ-ุฏุชุงุจุณ-database)
- [๐งช ุฑุงูโุงูุฏุงุฒ](#-ุฑุงูุงูุฏุงุฒ-setup)
- [๐ ุงุฌุฑุง](#-ุงุฌุฑุง-run)
- [๐ฅ ููุดโูุง ู ูพููโูุง](#-ููุดูุง-ู-ูพูููุง-roles--panels)
- [๐ ูฺฉุงุช ุงููุช](#-ูฺฉุงุช-ุงููุช)
- [๐ฆ ุงูุชุดุงุฑ ุฑู GitHub](#-ุงูุชุดุงุฑ-ุฑู-github-public-publishing)
- [๐ชช ูุฌูุฒ](#-ูุฌูุฒ-license)

## โจ ุงูฺฉุงูุงุช (Features)

- **ูพูู ุงุฏูู (Admin)**
  - ูุฏุฑุช ุณุงุฎุชูุงูโูุง/ูุงุญุฏูุง/ฺฉุงุฑุจุฑุงู
  - ฺฏุฒุงุฑุด ฺฉู ุณุณุชูุ ูุดุฏุงุฑูุง ุณุณุชูุ ฺฏุฒุงุฑุด ฺฉุฑุจู ุณุณุชู
  - ุชูุธู ูุฑุฎโูุง (ููุช ูพุงู ุขุจ/ุจุฑู/ฺฏุงุฒ)
  - ุงุจุฒุงุฑูุง ูุฏุฑุช: Seed ุฏุชุงุ ุดุจูโุณุงุฒ ุณุณุชูุ ูพุฑุณุชโูุงุ ูุถุนุช DBุ ูพุงุฏุงุด ฺฉูโูุตุฑูโูุงุ ูุฏุฑุช ูุจููฺฉ
  - **ุฑุณุช ฺฉุงูู ุฏุงุฏูโูุง** ุจุง ุชุงุฏ ุฏู ูุฑุญููโุง (ุญูุธ ุงุฏููโูุง)

- **ูพูู ูุฏุฑ ุณุงุฎุชูุงู (Manager)**
  - ูุดุงูุฏู ูุณุช ูุงุญุฏูุง ู ุฌุฒุฆุงุช ูุงุญุฏ
  - ูุตุฑู ูุญุธูโุง/ุงูุฑูุฒ ุณุงุฎุชูุงูุ ูุดุฏุงุฑูุง ุณุงุฎุชูุงู
  - ฺฏุฒุงุฑุด ฺฉุฑุจู ุณุงุฎุชูุงู (ุงูุฑูุฒ/ููุชู/ูุงู)
  - ูุถุนุช ุงุนุชุจุงุฑุงุช ูุงุญุฏูุง ุณุงุฎุชูุงู + ูุญุงุณุจู ูุฌุฏุฏ ุงุนุชุจุงุฑุงุช
  - ุดุจูโุณุงุฒ ุณุฑุน ุณุงุฎุชูุงู (ุจุฑุง ุชุณุช)

- **ูพูู ูุตุฑูโฺฉููุฏู (Consumer / Owner)**
  - ูุตุฑู ุงูุฑูุฒุ ุขูุงุฑ ููุชฺฏุ ูุฒููโูุง ูุงู ุฌุงุฑ
  - ฺฏุฒุงุฑุด ฺฉุฑุจู ูุงุญุฏ (ุงูุฑูุฒ/ููุชู/ูุงู) + ูฺฉุงุช ฺฉุงูุด
  - ูุดุฏุงุฑูุง (ุฎูุงูุฏู/ุฎูุงูุฏูโูุดุฏู)
  - ูุฏุฑุช ุงุนุชุจุงุฑุงุช ู ุฎุฑุฏ ุงุนุชุจุงุฑ
  - Digital Twin: ุณูุงุฑู/ูุตู/ูุณุงู/ุงฺฉู/ุจูุฏุฌู/ุญุณุงุณุชโูุง + ุดุจูโุณุงุฒ ู ูพุดโุจู ู ูพุดููุงุฏูุง ููุดููุฏ

## โ ูุงุฒููุฏโูุง (Requirements)

- PHP >= 8.1
- MySQL >= 8
- Composer

## ๐งฉ ุณุงุฎุชุงุฑ ูพุฑูฺู (Project Structure)

```
.
โโโ index.php                  # Entry point (Webhook + CLI polling/cron/webhook tools)
โโโ src/
โ   โโโ Bot/BotHandler.php     # Router ุงุตู ุขูพุฏุชโูุง ู ููุดโูุง
โ   โโโ Panels/
โ   โ   โโโ AdminPanel.php
โ   โ   โโโ ManagerPanel.php
โ   โ   โโโ ConsumerPanel.php
โ   โโโ Database/DB.php        # PDO singleton + helpers
โ   โโโ Models/                # User/Unit ูุฏูโูุง
โ   โโโ Services/              # ููุชูุฑูุง ุชุญูู/ฺฉุฑุจู/ุงุนุชุจุงุฑ/ุดุจูโุณุงุฒ/...
โ   โโโ Utils/                 # Telegram wrapper + Logger
โโโ migrations/schema.sql      # ุณุงุฎุชุงุฑ ุฏุชุงุจุณ
โโโ .env.example               # ููููู ูุชุบุฑูุง ูุญุท
โโโ .gitignore                 # ูุงูโูุง ุบุฑูุงุจู ุงูุชุดุงุฑ
โโโ .github/workflows/ci.yml   # CI ุณุงุฏู (composer validate + php -l)
```

## โ๏ธ ูุนูุงุฑ ู ูฺฉุงูุฒู ฺฉุงุฑ ุฑุจุงุช

### ูุณุฑ ูุฑูุฏ ุฏุฑุฎูุงุณุชโูุง

- **Webhook**: ุชูฺฏุฑุงู ุขูพุฏุช ุฑุง ุจู `index.php` ุงุฑุณุงู ูโฺฉูุฏ.
- **Polling**: ุจุง ุงุฌุฑุง `php index.php poll`ุ ุณุณุชู ุจุง `getUpdates` ุขูพุฏุชโูุง ุฑุง ูโฺฏุฑุฏ.

### ุถุฏ-ุชฺฉุฑุงุฑ (Anti-duplicate) ู ููู Polling

ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูพุฑุฏุงุฒุด ุชฺฉุฑุงุฑ ุขูพุฏุชโูุง:

- ุฏุฑ ุญุงูุช Polling ฺฉ ููู DB ุจุง `GET_LOCK('sbem_poll_lock', 0)` ฺฏุฑูุชู ูโุดูุฏ ุชุง ููุท **ฺฉ ูพุฑุฏุงุฒุด Polling** ูุนุงู ุจุงุดุฏ.
- ุจุฑุง ูุฑ ุฏู ุญุงูุช Webhook ู Pollingุ ููุฏุงุฑ `update_id` ุจูโุตูุฑุช ุงุชูฺฉ ุฏุฑ ุฌุฏูู `system_settings` ุจุง ฺฉูุฏ `runtime_last_update_id` ุฐุฎุฑู ูโุดูุฏ.
  - ุงฺฏุฑ `update_id` ูุจูุงู ูพุฑุฏุงุฒุด ุดุฏู ุจุงุดุฏุ ุขูพุฏุช **skip** ูโุดูุฏ.

### Router ููุดโูุง

`BotHandler.php`:

- ุขูพุฏุชโูุง ุฑุง ุจู ุฏู ุฏุณุชู ุชูุณู ูโฺฉูุฏ:
  - **Message** (ูุชู + Reply Keyboard)
  - **Callback Query** (Inline Keyboard)
- ุณูพุณ ุจุฑุงุณุงุณ ููุด ฺฉุงุฑุจุฑ ุฏุฑ ุฌุฏูู `users.role` ฺฉ ุงุฒ ูพููโูุง ุฑุง ุตุฏุง ูโุฒูุฏ:
  - `AdminPanel`
  - `ManagerPanel`
  - `ConsumerPanel`

### ุซุจุชโูุงู ู ุชุนู ููุด

- ุงููู ฺฉุงุฑุจุฑ ฺฉู ูุงุฑุฏ ุดูุฏุ ุงฺฏุฑ ูฺ ุงุฏูู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ **ุงุฏูู ูโุดูุฏ**.
- ุง ุงุฒ `.env`:
  - `ADMIN_TELEGRAM_IDS` (ูุณุช ฺฉุงูุง-ุฌุฏุง) ุจุฑุง ุงุฏูู ฺฉุฑุฏู ุฎูุฏฺฉุงุฑ ฺฉุงุฑุจุฑุงู ูุดุฎุต

## ๐๏ธ ุฏุชุงุจุณ (Database)

### ุณุงุฎุชุงุฑ ฺฉู

ุงุณฺฉูุง ุฏุฑ `migrations/schema.sql`:

- **users**: ฺฉุงุฑุจุฑุงู ุชูฺฏุฑุงู + ููุดโูุง + ุชุฎุตุต ุจู ุณุงุฎุชูุงู/ูุงุญุฏ
- **buildings**: ุณุงุฎุชูุงูโูุง + ูุฏุฑ ุณุงุฎุชูุงู
- **units**: ูุงุญุฏูุง + ูุงูฺฉ + ุชุนุฏุงุฏ ุณุงฺฉูู
- **unit_twin_states**: ูุถุนุช Digital Twin (ุณูุงุฑู/ูุตู/ุงฺฉู/ูุณุงู/ุญุณุงุณุชโูุง/ุจูุฏุฌู)
- **consumption_readings**: ุฏุงุฏูโูุง ูุตุฑู (ุขุจ/ุจุฑู/ฺฏุงุฒ)
- **consumption_limits**: ุณููโูุง ู ููุช ูุฑ ูุงุญุฏ ุจุฑุง ูุฑ ูุงุญุฏ ู ูุฑ ุจุงุฒู
- **energy_credits**: ุงุนุชุจุงุฑูุง ุจุฑุง ูุฑ ูุงุญุฏ ู ูุฑ ูุชุฑฺฉ
- **credit_transactions**: ุชุฑุงฺฉูุดโูุง ุฎุฑุฏ/ูุฑูุด/ุจุงูุงูุณ
- **alerts**: ูุดุฏุงุฑูุง (over-consumption / leak / low credit ...)
- **monthly_invoices**: ุฎุฑูุฌ ูุจุถ ูุงูุงูู (ุณุงุฏู)
- **system_settings**: ุชูุธูุงุช ุณุณุชู ู runtime ูุง

## ๐งช ุฑุงูโุงูุฏุงุฒ (Setup)

### 1) ูุตุจ ูุงุจุณุชฺฏโูุง

```bash
composer install
```

### 2) ุณุงุฎุช ูุงู `.env`

- `.env.example` ุฑุง ฺฉูพ ฺฉูุฏ ู ููุงุฏุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ.
- **ูุฑฺฏุฒ ูุงู `.env` ุฑุง commit ูฺฉูุฏ** (ุฏุฑ `.gitignore` ุงุฒ ูุจู ignore ุดุฏู).

### 3) ุณุงุฎุช ุฏุชุงุจุณ

```bash
mysql -u root -p smart_building < migrations/schema.sql
```

## ๐ ุงุฌุฑุง (Run)

### ุญุงูุช Polling (ูพุดููุงุฏ ุจุฑุง ููฺฉุงู)

```bash
php index.php poll
```

### ุญุงูุช Webhook (ูพุดููุงุฏ ุจุฑุง Production)

1) ูพุฑูฺู ุฑุง deploy ฺฉูุฏ.
2) ุฏุฑ `.env` ููุฏุงุฑูุง ุฒุฑ ุฑุง ุณุช ฺฉูุฏ:
- `TELEGRAM_WEBHOOK_URL` (ุขุฏุฑุณ ฺฉุงูู `index.php`)
- `TELEGRAM_WEBHOOK_SECRET` (ฺฉ ุฑุดุชู ุชุตุงุฏู)

ุณูพุณ ูุจููฺฉ ุฑุง ุชูุธู ฺฉูุฏ:

```bash
php index.php webhook-set
```

ุง ุงุฒ ุฏุงุฎู ุฑุจุงุช:

**ูพูู ุงุฏูู โ ุงุจุฒุงุฑูุง ๐งช โ ูุฏุฑุช ูุจููฺฉ ๐**

### ุงุฌุฑุง ฺฉ ุณฺฉู ุดุจูโุณุงุฒ/ุชุญูู (Cron-like)

ฺฉ ุจุงุฑ ุงุฌุฑุง ูโฺฉูุฏ:

- ุชููุฏ ุฏุงุฏู ูุตุฑู (Simulation)
- ุชุญูู ูุดุฏุงุฑูุง
- ูุญุงุณุจู ุงุนุชุจุงุฑุงุช (ููุท ุณุงุนุช 00:00)

```bash
php index.php cron
```

## ๐ฅ ููุดโูุง ู ูพููโูุง (Roles & Panels)

> ุฑุจุงุช ุฏู ููุน ุฏฺฉูู ุฏุงุฑุฏ:
>
>- **Reply Keyboard**: ุฏฺฉููโูุง ุซุงุจุช ูพุงู ุตูุญู
>- **Inline Keyboard**: ุฏฺฉููโูุง ุฏุงุฎู ูพุงู (callback)

### ุฏฺฉููโูุง ุนููู (ุจุฑุง ููู)

- **ุฑุงูููุง ๐**: ุฑุงูููุง ุณุฑุน (ูุญูู ุงุณุชูุงุฏู ู ูฺฉุงุช)
- **ุดูุงุณู ูู ๐**: ููุงุด Telegram ID
- **ููู ุงุตู ๐**: ุจุฑฺฏุดุช ุจู ุฏุงุดุจูุฑุฏ ููุด ูุฑุจูุทู

### ูพูู ุงุฏูู (AdminPanel)

**ูุฏู**: ูุฏุฑุช ฺฉู ุณุณุชู.

#### Reply Keyboard (ููู ุซุงุจุช)

- **ฺฏุฒุงุฑุด ๐** โ ฺฏุฒุงุฑุด ฺฉู ุณุณุชู
- **ูุดุฏุงุฑูุง โ๏ธ** โ ูุณุช ูุดุฏุงุฑูุง ุณุณุชู + ุฎูุงูุฏูโุดุฏู ููู
- **ฺฉุฑุจู ๐** โ ฺฏุฒุงุฑุด ฺฉุฑุจู ุณุณุชู (ุงูุฑูุฒ/ููุชู/ูุงู)
- **ฺฉุงุฑุจุฑุงู ๐ฅ** โ ูุฏุฑุช ฺฉุงุฑุจุฑุงู (ุงุฏูู/ูุฏุฑ/ูุตุฑูโฺฉููุฏู + ุชุฎุตุต)
- **ุณุงุฎุชูุงูโูุง ๐ข** โ ูุฏุฑุช ุณุงุฎุชูุงูโูุง
- **ููุชโูุง ๐ฒ** โ ุชูุธู ูุฑุฎโูุง ูพุงู
- **ุชูุธูุงุช โ๏ธ** โ ููุงุด ุชูุธูุงุช ุณุณุชู (ุจูโุฌุฒ `runtime_*`)
- **ุงุจุฒุงุฑูุง ๐งช** โ ุงุจุฒุงุฑูุง ุฏูู/ุชุณุช/ูุจููฺฉ/ุฑุณุช

#### Inline Actions ููู (callback_data)

- `admin_report` โ ฺฏุฒุงุฑุด ุณุณุชู
- `admin_alerts` โ ูุดุฏุงุฑูุง ุณุณุชู
- `admin_carbon` / `admin_carbon_week` / `admin_carbon_month` โ ฺฉุฑุจู ุณุณุชู
- `admin_tools_*` โ ุงุจุฒุงุฑูุง (Seed / Presets / Simulate / DB status / Reward / Reset all)
- `admin_webhook_*` โ ูุฏุฑุช ูุจููฺฉ (info/set/delete)

#### ูุงุจูุชโูุง ฺฉูุฏ

- **ุชุฎุตุต ููุดโูุง ู ุชุฎุตุต ุณุงุฎุชูุงู/ูุงุญุฏ**
  - ุชุจุฏู ฺฉุงุฑุจุฑ ุจู manager/consumer
  - ุงุชุตุงู manager ุจู building
  - ุงุชุตุงู consumer ุจู unit
- **ุฑุณุช ููู ุฏุงุฏูโูุง**
  - ููู: ุงุจุฒุงุฑูุง ๐งช โ ุฑุณุช ููู ุฏุงุฏูโูุง โป๏ธ โ ุชุงุฏ
  - ูพุงฺฉโุณุงุฒ ุฌุฏููโูุง ุงุตู ู reset `runtime_last_update_id`
  - ฺฉุงุฑุจุฑุงู admin ุญูุธ ูโุดููุฏ

### ูพูู ูุฏุฑ ุณุงุฎุชูุงู (ManagerPanel)

**ูุฏู**: ูุฏุฑุช ู ูุงูุชูุฑูฺฏ ฺฉ ุณุงุฎุชูุงู.

#### Reply Keyboard

- **ูุงุญุฏูุง ๐** โ ูุณุช ูุงุญุฏูุง + ุฌุฒุฆุงุช ูุงุญุฏ
- **ูุตุฑู ูุญุธูโุง ๐** โ ุฎูุงุตู ูุตุฑู ุงูุฑูุฒ ุณุงุฎุชูุงู
- **ูุดุฏุงุฑูุง โ๏ธ** โ ูุดุฏุงุฑูุง ุณุงุฎุชูุงู + mark all read
- **ฺฉุฑุจู ๐** โ ฺฉุฑุจู ุณุงุฎุชูุงู (ุงูุฑูุฒ/ููุชู/ูุงู)
- **ุงุนุชุจุงุฑุงุช ๐ฐ** โ ูุถุนุช ุงุนุชุจุงุฑุงุช ูุงุญุฏูุง + ูุญุงุณุจู ูุฌุฏุฏ
- **ุดุจูโุณุงุฒ ๐งช** โ ุงุฌุฑุง ฺฉ ูุฑุญูู ุดุจูโุณุงุฒ ุจุฑุง ุณุงุฎุชูุงู

#### Inline Actions ููู

- `mgr_units` / `mgr_unit_{id}` โ ูุณุช ู ุฌุฒุฆุงุช ูุงุญุฏ
- `mgr_live_consumption` โ ูุตุฑู ุงูุฑูุฒ
- `mgr_alerts` / `mgr_mark_all_read` โ ูุดุฏุงุฑูุง
- `mgr_carbon` / `mgr_carbon_week` / `mgr_carbon_month` โ ฺฉุฑุจู
- `mgr_credits` / `mgr_recalculate_credits` โ ุงุนุชุจุงุฑุงุช
- `mgr_sim_now` โ ุดุจูโุณุงุฒ ุณุงุฎุชูุงู

### ูพูู ูุตุฑูโฺฉููุฏู (ConsumerPanel)

**ูุฏู**: ูุดุงูุฏู ูุตุฑูุ ูุฒููุ ฺฉุฑุจูุ ูุดุฏุงุฑ ู ฺฉูุชุฑู Digital Twin.

#### Reply Keyboard

- **ูุตุฑู ุงูุฑูุฒ ๐** โ ูุตุฑู ุงูุฑูุฒ ูุงุญุฏ
- **ุขูุงุฑ ููุชฺฏ ๐** โ ฺฏุฒุงุฑุด ุชุฌูุน ููุช ุฑูุฒ ุงุฎุฑ
- **ูุฒููโูุง ๐ต** โ ูุฒููโูุง ูุงู ุฌุงุฑ + ุฏุฑุตุฏ ูุตุฑู ูุณุจุช ุจู ุณูู
- **ฺฉุฑุจู ๐** โ ฺฏุฒุงุฑุด ฺฉุฑุจู ูุงุญุฏ (ุงูุฑูุฒ/ููุชู/ูุงู)
- **ูุดุฏุงุฑูุง โ๏ธ** โ ูุณุช ูุดุฏุงุฑูุง ูุงุญุฏ
- **ุงุนุชุจุงุฑุงุช ๐ฐ** โ ููุฌูุฏ ุงุนุชุจุงุฑูุง + ุฎุฑุฏ ุงุนุชุจุงุฑ
- **ูุฏุฑุช ููุดููุฏ ๐** โ ููู Digital Twin
- **ุชูุงุณ ุจุง ูุฏุฑ ๐** โ ููุงุด ุงุฏููโูุง ุณุณุชู (ุจุฑุง ฺฉุงุฑุจุฑุงู ุจุฏูู ุชุฎุตุต ูู ูุนุงู ุงุณุช)

#### Digital Twin (Smart Menu)

ููู: **ูุฏุฑุช ููุดููุฏ ๐**

- **ุณูุงุฑู ๐ญ**: empty/family/party/night/travel
- **ูุตู ๐**: spring/summer/autumn/winter
- **ุชุฌูุฒุงุช ๐งฉ**: ฺุฑุงุบโูุง / ุขุจฺฏุฑูฺฉู / ฺฉููุฑ / ฺฏุฑูุงุด
- **Eco Mode โป๏ธ**: ฺฉุงูุด ูุตุฑู ุจุฑุงุณุงุณ ุญุณุงุณุชโูุง
- **ุจูุฏุฌู ๐ฐ**: ุชูุธู ุจูุฏุฌู ูุงูุงูู
- **ุญุณุงุณุชโูุง ๐ฏ**: cost/green
- **ุดุจูโุณุงุฒ ุงูุงู ๐งช**: ุชููุฏ ฺฉ ูุฑุญูู ุฏุงุฏู ุฌุฏุฏ ุจุฑุง ูุงุญุฏ
- **ูพุดโุจู ๐ฎ**: ูพุดโุจู ูุฒูู ูุงู ู ุฑุณฺฉ ุนุจูุฑ ุงุฒ ุจูุฏุฌู
- **ูพุดููุงุฏูุง ููุดููุฏ ๐ง**: ูพุดููุงุฏูุง ูุงุจู ุงุฌุฑุง (ุงฺฉุดูโูุง ุณุฑุน)

#### ุงุนุชุจุงุฑุงุช (Credits)

- ุฎุฑุฏ ุงุนุชุจุงุฑ: `con_buy_credit` โ ุงูุชุฎุงุจ ูุชุฑฺฉ โ ุงูุชุฎุงุจ ููุฏุงุฑ โ ุซุจุช ุชุฑุงฺฉูุด `system_purchase`
- ูุฑูุด ุงุนุชุจุงุฑ: ุฏุฑ ูุณุฎู ูุนู **ุจุงุฒุงุฑ ูุฑูุด ุฎูุฏฺฉุงุฑ ูพุงุฏูโุณุงุฒ ูุดุฏู** ู ุตุฑูุงู ูพุงู ุฑุงูููุง ููุงุด ุฏุงุฏู ูโุดูุฏ.

## ๐งพ ุชูุธูุงุช ูุญุท (.env)

ููููู ุฏุฑ `.env.example`:

- DB:
  - `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASS`
- Telegram:
  - `TELEGRAM_BOT_TOKEN`
  - `TELEGRAM_WEBHOOK_URL`
  - `TELEGRAM_WEBHOOK_SECRET`
- Admin bootstrap:
  - `ADMIN_TELEGRAM_IDS` (comma-separated)
- Logging:
  - `LOG_FILE` (ุงุฎุชุงุฑ)

ูฺฉุชูโูุง ููู:

- ููุชโูุง ูพุงู ุฏุฑ ุนูู ุงุฒ ุฏุชุงุจุณ ู ุฌุฏูู `system_settings` ุจุง ฺฉูุฏูุง `base_price_*` ุฎูุงูุฏู ูโุดููุฏ ู ุงุฒ ุฏุงุฎู ูพูู ุงุฏูู ูุงุจู ุชุบุฑูุฏ.
  - ูุชุบุฑูุง `BASE_PRICE_*` ุฏุฑ `.env.example` ุตุฑูุงู ุจุฑุง ููููู/ููโุฑุงุณุชุง ุจุง ููุฏุงุฑูุง ุงููู ุงุณฺฉูุง ูุณุชูุฏ ู ยซููุจุน ุงุตู ููุชยป ูุณุชูุฏ.
- ูุชุบุฑูุง `SIMULATION_ENABLED` ู `SIMULATION_INTERVAL` ุจุฑุง ุจุฑูุงููโุฑุฒ ุงุฌุฑุง cron/polling ููุฏ ูุณุชูุฏุ ุงูุง ุงูุฒุงูุงู ุฏุฑ ฺฉุฏ ุจูโุตูุฑุช ุณุฎุชโฺฏุฑุงูู enforce ูุดุฏูโุงูุฏ (ุฒูุงูโุจูุฏ ุฑุง ุจุฑูู ุงุฒ ุจุฑูุงูู ุชูุธู ฺฉูุฏ).
- ูุงูโูุง ูุซู `.env.local` ูู ุจูโุตูุฑุช ูพุดโูุฑุถ ุชูุณุท `.gitignore` ุงุฒ ุงูุชุดุงุฑ ุฏุฑ GitHub ุฌููฺฏุฑ ูโุดููุฏ.

## ๐ ูฺฉุงุช ุงููุช

- **Webhook Secret**: ุงฺฏุฑ `TELEGRAM_WEBHOOK_SECRET` ุณุช ุจุงุดุฏุ `index.php` ูุฏุฑ `X-Telegram-Bot-Api-Secret-Token` ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ.
- **ุนุฏู Commit ุงุทูุงุนุงุช ุญุณุงุณ**: `.env` ู `.env.*` ูุจุงุฏ ุฑู GitHub ุจุฑููุฏ.

## ๐ฆ ุงูุชุดุงุฑ ุฑู GitHub (Public Publishing)

ุงู ูพุฑูฺู ุจุฑุง ูพุงุจูฺฉ ุดุฏู ุขูุงุฏู ุงุณุช. ููุงุฑุฏ ฺฉู ูุจุงุฏ ุขูพููุฏ ุดููุฏ (ุฏุฑ `.gitignore` ุชูุธู ุดุฏู):

- `.env`
- `.env.*` (ุจูโุฌุฒ `.env.example`)
- `vendor/`
- `logs/`
- ูุงูโูุง IDE (`.idea/`, `.vscode/`) ู ูุงูโูุง ูููุช

ูพุดููุงุฏ ูุจู ุงุฒ publish:

1) ูุทูุฆู ุดู ูุงู `.env` ุญุงู ุชูฺฉู ูุงูุน ุฏุงุฎู repo ูุณุช.
2) ุงฺฏุฑ `logs/` ูุงู ูุงฺฏ ุฏุงุฑุฏุ commit ูุดูุฏ.
3) ุงฺฏุฑ webhook ุฑุง ูุจูุงู ุฑู URL ูุงูุน ุณุช ฺฉุฑุฏูโุงุ secret ุฑุง ุนูุถ ฺฉู.

### ๐ ุฏุณุชูุฑุงุช ูพุงุจูุด ฺฉุฑุฏู (Publish Commands)

> ูฺฉุชู: ุงู ุฏุณุชูุฑุงุช ุฑุง ุฏุงุฎู PowerShell / CMD / Git Bash ุงุฌุฑุง ฺฉู.

#### ุญุงูุช 1: ุงููู ุจุงุฑ (ุณุงุฎุช repo ูุญู ู push ุจู GitHub)

ุงฺฏุฑ ุงู ูพุฑูฺู ูููุฒ git ูุณุช:

```bash
git init
git add -A
git commit -m "chore: initial public release"
git branch -M main
git remote add origin https://github.com/SeniorAminam/SBEMSB.git
git push -u origin main
```

#### ุญุงูุช 2: ุขูพุฏุช ูุณุฎู (ููุช repo ุงุฒ ูุจู ูุณุช)

```bash
git status
git add -A
git commit -m "docs: update README and project documentation"
git push
```

#### ุชฺฏ ู Release (ูพุดููุงุฏ ุจุฑุง GitHub)

```bash
git tag -a v1.0.0 -m "v1.0.0 - First public release"
git push origin v1.0.0
```

ุณูพุณ ุฏุฑ GitHub:

- ุจู **Releases** ุจุฑู
- ุฑู **Draft a new release** ุจุฒู
- Tag ุฑุง `v1.0.0` ุงูุชุฎุงุจ ฺฉู ู Release notes ุจููุณ

## ๐งฐ ุชฺฉููููฺโูุง ู ุงุณุชฺฉ

- **๐ PHP 8.1+** (Strict Types) + ูุนูุงุฑ ูุงฺููุงุฑ (Panels/Services/Models)
- **๐งฐ Composer** (Autoload PSR-4)
- **๐๏ธ MySQL 8+** (InnoDB, utf8mb4)
- **๐ PDO** (Prepared Statements)
- **๐ค Telegram Bot API**
  - Webhook + Secret Token validation
  - Long Polling (CLI)
- **๐งช Simulation & Digital Twin**
  - `DataSimulator` ุจุฑุง ุชููุฏ ุฏุงุฏูโูุง ูุตุฑู ุขุจ/ุจุฑู/ฺฏุงุฒ
  - `DigitalTwinEngine` ุจุฑุง ูุฏุฑุช ุณูุงุฑู/ูุตู/ุงฺฉู/ูุณุงู/ุญุณุงุณุชโูุง
- **๐ Analytics**
  - `ConsumptionAnalyzer` ุจุฑุง ุชููุฏ ูุดุฏุงุฑูุง
  - `ForecastEngine` ุจุฑุง ูพุดโุจู ูุฒูู ูุงู ู ุฑุณฺฉ ุจูุฏุฌู
  - `CarbonEngine` ุจุฑุง ูุญุงุณุจู ฺฉุฑุจู (COโe)
- **๐งพ Logging**
  - Logger ูุงูโูุญูุฑ (`logs/bot.log`) + JSON log lines
- **โ GitHub Actions (CI)**
  - Composer validate + PHP lint

## ๐งโ๐ป ุฏุฑุจุงุฑู ุณุงุฒูุฏู

<div align="center">
  <a href="https://github.com/SeniorAminam">
    <img src="https://github.com/SeniorAminam.png?size=140" alt="Amin Davodian" />
  </a>
</div>

### ๐ค Amin Davodian (Mohammadamin Davodian)

- **๐ Website**: https://senioramin.com
- **๐ผ LinkedIn**: https://linkedin.com/in/SudoAmin
- **๐ป GitHub**: https://github.com/SeniorAminam

ุงู ูพุฑูฺู ุจูโุนููุงู ฺฉ ูููููโ ุนูู ุงุฒ ุชูุงูููุฏโูุง ูู ุฏุฑ ุญูุฒูโูุง ุฒุฑ ุทุฑุงุญ ู ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุช:

- **๐๏ธ ุทุฑุงุญ ูุนูุงุฑ ู ุณุณุชูโูุง Production-Ready**
- **๐ค ุชูุณุนู ุฑุจุงุชโูุง ุชูฺฏุฑุงู** (Webhook/Pollingุ ูุฏุฑุช stateุ ุฌููฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ ูพุงู)
- **๐๏ธ ุทุฑุงุญ ุฏุชุงุจุณ ู Query Optimization** (MySQLุ ุงูุฏฺฉุณโูุงุ integrity)
- **๐ ุชุญูู ุฏุงุฏู ู ุชููุฏ ูุดุฏุงุฑ** (Rule-based analytics)
- **๐ ูพุงุฏุงุฑ ู ุงูุฑฺ** (Carbon footprintุ ฺฏุฒุงุฑุดโูุง ูุตุฑู)
- **๐ง ุณุณุชูโูุง ููุดููุฏ ู Digital Twin** (ุณูุงุฑูุ ูุตูุ Eco Modeุ ฺฉูุชุฑู ุชุฌูุฒุงุช)

## ๐ชช ูุฌูุฒ (License)

MIT
